---
layout:     post
title:      alloc底层原理
subtitle:   alloc底层原理
date:       2020-10-26
author:     KG丿夏沫
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - iOS
    - NSObject
    - alloc
    - malloc
    - 字节对齐
---

# alloc底层原理

<img src="/img/20201026002.png"  alt="alloc" />

>在iOS开发中，创建对象的时候，经常会用到一个函数```alloc```，所以今天就探索下```alloc```的底层原理，俗话说工欲善其事必先利其器，下面我们介绍下，探索底层的东西，需要的一些基本准备东西。

### 准备工作

1、[objc](https://opensource.apple.com/source/)是探索底层原理的一个重要工具，我们可以通过苹果开源的东西，去了解他的设计理念以及程序运行的流程，目前最新的是```objc4-781```，我的设备上运行起来的是```objc4-779.1```。

2、肯定是对iOS开发有所了解了，起码得有iOS实际开发经验最少也得半年或者一年以上吧。

3、手头有一台Mac电脑，Mac电脑上安装后Xcode。

......嗯，暂时就这些吧~~~

### alloc底层原理探索

1、首先打开已经配置好的```objc```项目。项目打开后如下图所示：

<img src="/img/20201026001.png"  alt="项目配置后" />

2、接下来就开始不如今天探索的重点，我们在创建一个对象的时候，总是会写```[XXXXX alloc]```，这个alloc是干什么的，我想很多人都能回答(创建对象，并给对象开辟内存空间)，但是他的内部是怎么实现的，创建的对象开辟了多少内存？怎么计算的？很多人到这里就开启了一万个为什么模式。那好，下面我们开始一起探索这些问题。

3、我们在编译好的objc工程中，在```KCObjcTest```文件夹下创建基于NSObject的类```KGPerson```，然后在```main.m```文件中引入头文件```# import "KGPerson.h"```。各个文件内容如下：

>KGPerson.h文件

<img src="/img/20201026003.png" alt="KGPerson.h文件">

>KGPerson.m文件

<img src="/img/20201026004.png" alt="KGPerson.m文件">

>main.m文件

<img src="/img/20201026005.png" alt="main.m文件">